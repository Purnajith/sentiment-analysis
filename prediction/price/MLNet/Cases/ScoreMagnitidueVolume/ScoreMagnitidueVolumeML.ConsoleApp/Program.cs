// This file was auto-generated by ML.NET Model Builder. 

using System;
using ScoreMagnitidueVolumeML.Model;

namespace ScoreMagnitidueVolumeML.ConsoleApp
{
    class Program
    {
        static void Main(string[] args)
        {
            string selection = String.Empty;
            do
            {
                Console.WriteLine("=====================================");

                Console.WriteLine("Please select");
                Console.WriteLine("Build = 1");
                Console.WriteLine("Build and Predict = 2");
                Console.WriteLine("Predict = 3");
                Console.WriteLine("Exit = -99");

                selection = Console.ReadLine();

                if (selection == "1") 
                {
                    Build();
                }
                else if (selection == "2")
                {
                    BuildAndPredict();
                }

                else if (selection == "3")
                {
                    PredictOnly();
                }


                Console.WriteLine("=====================================");
            }
            while (selection != "-99");
        }

        private static void Build()
        {
            ModelBuilder.CreateModel(null);
        }

        private static void BuildAndPredict()
        {
            Console.WriteLine("Enter - CompanyID");
            string CompanyID = Console.ReadLine();

            Console.WriteLine("Enter - Magnitude");
            string Magnitude = Console.ReadLine();

            Console.WriteLine("Enter - Score");
            string Score = Console.ReadLine();

            ModelBuilder.CreateModel(int.Parse(CompanyID));

            DisplayPredict(Convert.ToInt32(CompanyID),
                            Convert.ToDouble(Magnitude),
                            Convert.ToDouble(Score));
        }

        private static void PredictOnly()
        {
            Console.WriteLine("Enter - CompanyID");
            string CompanyID = Console.ReadLine();

            Console.WriteLine("Enter - Magnitude");
            string Magnitude = Console.ReadLine();

            Console.WriteLine("Enter - Score");
            string Score = Console.ReadLine();

            DisplayPredict(Convert.ToInt32(CompanyID),
                            Convert.ToDouble(Magnitude),
                            Convert.ToDouble(Score));
        }


        private static void DisplayPredict(int CompanyID, double Magnitude, double Score)
        {
            // Create single instance of sample data from first line of dataset for model input
            ModelInput sampleData = new ModelInput()
            {
                CompanyID = CompanyID,
                Magnitude = (float) Magnitude,
                Score = (float) Score,
            };

            // Make a single prediction on the sample data and print results
            var predictionResult = ConsumeModel.Predict(sampleData);

            Console.WriteLine("Using model to make single prediction -- Comparing actual Volume with predicted Volume from sample data...\n\n");
            Console.WriteLine($"CompanyID: {sampleData.CompanyID}");
            Console.WriteLine($"Magnitude: {sampleData.Magnitude}");
            Console.WriteLine($"Score: {sampleData.Score}");
            Console.WriteLine($"\n\nPredicted Volume: {predictionResult.Score}\n\n");
            Console.WriteLine("=============== End of process, hit any key to finish ===============");
            Console.ReadKey();
        }
    }
}
